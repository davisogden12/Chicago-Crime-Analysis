---
title: "Project 5 - Spatial Clustering and Structure of Crimes in the City of Chicago"
output:
  word_document:
    reference_docx: CE 597 Project Report Template.docx
---

# Abstract

------------------------------------------------------------------------

# Data Exploration

```{r setup, include=FALSE}
library(stringr)
library(rmarkdown)
library(sf)
library(ggplot2)
library(dplyr)
library(stringi)
library(lubridate)
library(mapview)
library(leafpop)
library(spatstat)
library(dbscan)
library(RColorBrewer)
library(nngeo)
library(tibble)
library(factoextra)
library(png)
knitr::opts_chunk$set(echo=FALSE, include = FALSE, fig.width = 5, fig.height = 3,
                      fig.align = 'center')
data=read.csv('CrimesChicago20220225.csv')
data=data[,c('DATE..OF.OCCURRENCE','PRIMARY.DESCRIPTION','BEAT',
              'WARD','LATITUDE','LONGITUDE')]
data=na.omit(data)
data$DATE..OF.OCCURRENCE=as.POSIXlt(data$DATE..OF.OCCURRENCE,
                                    tz='America/Detroit',
                                    tryFormats ='%m/%d/%Y %I:%M:%S %p')
data=data%>%
  rename(DATE=DATE..OF.OCCURRENCE,DESCRIPTION=PRIMARY.DESCRIPTION)
```

```{r Task_1-1, echo=TRUE, fig.align='center', fig.height=3, fig.width=5, include=TRUE}
data=data%>%
  rename_with(.fn = function(x){str_to_title(x)})%>%
  mutate(Day=wday(Date,label=TRUE)) %>%
  mutate(Month=month(Date,label=TRUE))%>%
  mutate(Hour=hour(Date))
ggplot(data = data, aes(x=Hour))+
  stat_count(fill='lightblue',color='black')+
  labs(title = 'Hourly Crime Distribution')+
  ylab('Frequency')+
  scale_x_discrete(breaks=1:23, limits=as.character(1:23))+
  theme_gray()+
  theme(plot.title = element_text(hjust = 0.5, size = 12))
```

```{r Task_1-2}
#group according to crime "category"
violent=str_c(c('HOMICIDE','ASSAULT','BATTERY'), collapse = '|')
theft=str_c(c('MOTOR VEHICLE THEFT','ROBBERY','BURGLARY','THEFT'), collapse = '|')
narcotic=str_c(c('NARCOTICS','OTHER NARCOTIC VIOLATION'), collapse = '|')
data_filtered=data%>%
  mutate(Category=case_when(str_detect(Description,violent)~'Violent',
                        str_detect(Description,theft)~'Theft',
                        str_detect(Description,narcotic)~'Drug',
                        .default = 'Other' ))%>%
  filter(str_detect(Category,'Violent|Theft|Drug'))
```

```{r stacked_hist, echo=TRUE, fig.height=3, fig.width=5}
#hourly crime distribution by category of crime
data_filtered%>%
  group_by(Category,Hour)%>%
  ggplot(aes(x=Hour,fill=Category))+
  labs(title='Hourly Crime Distribution')+
  ylab('Frequency')+
  stat_count(color='black')+
  scale_x_discrete(breaks=1:23, limits=as.character(1:23))+
  theme_grey()+
  theme(plot.title = element_text(hjust = 0.5, size = 12))

```

```{r Task}
data_sf=st_as_sf(data_filtered,
                 coords = c('Longitude','Latitude'),
                 crs = 'EPSG:4326')
data_sf=data_sf%>%
  filter(!is.na(geometry))
shp=list.files(pattern = '.shp')
mapviewOptions(basemaps='OpenStreetMap', fgb = FALSE)
crime_map=mapview(data_sf,
                  zcol='Category',
                  col.regions=brewer.pal(3,'Dark2'),
                  legend=TRUE,
                  popup=popupTable(x=data_sf,
                                   row.numbers=FALSE,
                                   feature.id=FALSE),
                  layer.name='Crime Spatial Distribution')
knitr::include_graphics('mapshot.png')
```

------------------------------------------------------------------------

# Spatial Clustering

```{r violent_points}
violent=data_filtered%>%
  filter(Category=='Violent')%>%
  select(Latitude,Longitude)
ggplot(violent,aes(y=Latitude,x=Longitude))+
  geom_point()+
    coord_sf(crs='EPSG:4326')+
  theme_grey()+
  theme(plot.title = element_text(hjust = 0.5, size = 12))
```

```{r violent_clusters}
violent%>%
dbscan(eps=1.5/6371, minPts = 10)%>%
  fviz_cluster(data = violent, geom = 'point', main = 'Clustering of Violent Crimes', pointsize = 0.1)
```

------------------------------------------------------------------------

# Spatial Structure

------------------------------------------------------------------------

# Summary/Concluding Remarks

------------------------------------------------------------------------

# Appendix

```{r daily_crime_dist}
#daily crime distribution
knitr::opts_chunk$set(echo = TRUE)
ggplot(data = data, aes(x=Day))+
  stat_count(fill='lightblue',color='black')+
  labs(title='Daily Crime Distribution')+
  xlab('Day')+
  ylab('Frequency')+
  scale_x_discrete()+
  theme_gray()+
  theme(plot.title = element_text(hjust = 0.5, size = 12))
```

```{r}
#monthly crime distribution
ggplot(data = data, aes(x=Month))+
  stat_count(fill='lightblue',color='black')+
  labs(title='Monthly Crime Distribution')+
  ylab('Frequency')+
  scale_x_discrete()+
  theme_gray()+
  theme(plot.title = element_text(hjust = 0.5, size = 12))
```

```{r, fig.height=5}
#monthly crime distribution
ggplot(data = data, aes(x=Description))+
  stat_count(fill='lightblue',color='black')+
  labs(title='Crime Distribution by Category')+
  ylab('Frequency')+
  theme_grey()+
  theme(axis.text.y = element_text(size = 7))+
  coord_flip()+
  theme(plot.title = element_text(hjust = 0.5, size = 12))
```
